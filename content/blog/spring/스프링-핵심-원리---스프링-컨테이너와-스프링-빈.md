---
title: 스프링 핵심 원리 - 스프링 컨테이너와 스프링 빈
date: 2020-11-14 10:11:81
category: spring
draft: false
---

## 스프링 컨테이너 생성

```java
ApplicationContext applicationContext = new AnnotationConfigApplicationContext(AppConfig.class);
```

- ApplicationContext를 스프링 컨테이너라 한다.
- ApplicationContext는 인터페이스이다.
- 스프링 컨테이너는 XML을 기반으로 만들 수 있고, 애노테이션 기반의 자바 설정 클래스로 만들 수 있다.
    > 요즘에는 XML 기반으로 만드는 건 잘 사용하지 않는다. 스프링 부트 자체가 어노테이션 기반으로 쉽게 작동하게 되어있어서 요즘엔 어노테이션 기반으로 한다.
- 직전에 AppConfig 를 사용했던 방식이 애노테이션 기반의 자바 설정 클래스로 스프링 컨테이너를 만든 것이다.
- 자바 설정 클래스를 기반으로 스프링 컨테이너(ApplicationContext)를 만들어보자.
  - new AnnotationConfigApplicationContext(AppConfig.class);
  - 이 클래스는 ApplicationContext 인터페이스의 구현체이다.

> 참고 : 더 정확히는 스프링 컨테이너를 부를 때 BeanFactory, ApplicationContext로 구분해서 이야기한다. BeanFactory를 직접 사용하는 경우는 거의 없으므로 일반적으로 ApplicationContext를 스프링 컨테이너라 한다.

### 스프링 컨테이너의 생성 과정

1. 스프링 컨테이너 생성
   - new AnnotationConfigApplicationContext(AppConfig.class)
   - 스프링 컨테이너를 생성할 때는 구성 정보를 지정해주어야 한다.
   - 여기서는 AppConfig.class를 구성 정보로 지정했다.

2. 스프링 빈 등록
- 스프링 컨테이너는 파라미터로 넘어온 설정 클래스 정보를 사용해서 스프링 빈을 등록한다.
> 빈 이름 : 빈 이름은 메서드 이름을 사용한다.  
> 빈 이름을 직접 부여할 수 도 있다. @Bean(name="memberService2")

> 주의 : 빈 이름은 항상 다른 이름을 부여해야 한다. 같은 이름을 부여하면 다른 빈이 무시되거나, 기존 빈을 덮어버리거나 설정에 따라 오류가 발생한다. -> 문제를 단순하게 해결하기!

3. 스프링 빈 의존 관계 설정 - 준비

4. 스프링 빈 의존관계 설정 - 완료
- 스프링 컨테이너는 설정 정보를 참고해서 의존관계를 주입(DI)한다.
- 단순히 자바 코드를 호출하는 것 같지만, 차이가 있다. (이후 싱글톤 컨테이너 참고)

**참고**  
스프링은 빈을 생성하고, 의존관계를 주입하는 단계가 나누어져 있다.(실제 스프링의 라이프 사이클에서) 그런데 이렇게 자바 코드로 스프링 빈을 등록하면 생성자를 호출하면서 의존관계 주입도 한번에 처리된다. (이후 의존관계 자동 주입 참고)


## 컨테이너에 등록된 모든 빈 조회

스프링 컨테이너에 실제 스프링 빈들이 잘 등록 되었는지 확인

JUnit 5 부터는 test 클래스와 메소드에 public 설정 안해도 됨

스프링 내부에 있는거 빼고 출력 - 애플리케이션 빈 출력

beanDefinition : 빈에 대한 정보들(메타데이터)
getRole() : 애플리케이션을 위해 등록한 빈들 혹은 외부 라이브러리

1. 모든 빈 출력하기
- 실행하면 스프링에 등록된 모든 빈 정보를 출력할 수 있다.
- ac.getBeanDefinitionNames() : 스프링에 등록된 모든 빈 이름을 조회한다.
- ac.getBean() : 빈 이름으로 빈 객체(인스턴스)를 조회한다.

2. 애플리케이션 빈 출력하기
- 스프링이 내부에서 사용하는 빈은 제외하고, 내가 등록한 빈만 출력해보자.
- 스프링이 내부에서 사용하는 빈은 getRole() 로 구분할 수 있다.
  - ROLE_APPLICATION : 일반적으로 사용자가 정의한 빈
  - ROLE_INFRASTRUCTURE : 스프링이 내부에서 사용하는 빈


## 스프링 빈 조회 - 기본

스프링 컨테이너에서 스프링 빈을 찾는 가장 기본적인 조회 방법
- ac.getBean(빈이름, 타입)
- ac.getBean(타입)
- 조회 대상 스프링 빈이 없으면 예외 발생
  - NoSuchBeanDefinitionException: No bean named 'xxxxx' available

1. 빈 이름으로 조회
2. 이름 없이 타입으로만 조회
3. 구체 타입으로 조회
4. 빈 이름으로 조회X (실패 테스트)

구체 타입으로 조회 - 인스턴스 타입으로 조회 -> 구체적으로 적는 것은 안좋음. (역할에 의존하지 않고 구현에 의존했기 때문, 유연하지 않음)


## 스프링 빈 조회 - 동일한 타입이 둘 이상

- 타입으로 조회시 같은 타입의 스프링 빈이 둘 이상이면 오류가 발생한다. 이때는 빈 이름을 지정한다.
- ac.getBeansOfType() 을 사용하면 해당 타입의 모든 빈을 조회할 수 있다.

1. 타입으로 조회 시 같은 타입이 둘 이상 있으면 중복 오류 발생
2. 타입으로 조회 시 같은 타입이 둘 이상 있으면 빈 이름 지정하면 됨
3. 특정 타입을 모두 조회

---

## 출처

> 인프런 '스프링 입문 - 코드로 배우는 스프링 부트, 웹 MVC, DB 접근