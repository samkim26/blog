---
title: 스프링 입문 - AOP
date: 2020-10-25 12:10:83
category: spring
draft: false
---

## AOP가 필요한 상황

AOP : Aspect Oriented Programming

AOP를 언제, 왜 쓰는지 알면 됨!

- 모든 메소드의 호출 시간을 측정하고 싶다면?
- 공통 관심 사항(cross-cutting concern) vs 핵심 관심 사항(core concern)
- 회원 가입 시간, 회원 조회 시간을 측정하고 싶다면?

**문제**
- 회원가입, 회원 조회에 시간을 측정하는 기능은 핵심 관심 사항이 아니다.
- 시간을 측정하는 로직은 공통 관심 사항이다.
- 시간을 측정하는 로직과 핵심 비즈니스의 로직이 섞여서 유지보수가 어렵다.
- 시간을 측정하는 로직을 별도의 공통 로직으로 만들기 매우 어렵다.
- 시간을 측정하는 로직을 변경할 때 모든 로직을 찾아가면서 변경해야 한다.


## AOP 적용

공통 관심 사항(cross-cutting concern) vs 핵심 관심 사항(core concern) 분리

시간 측정 로직을 한 군데 모으고 원하는 곳에 적용 -> 이것을 가능하게 하는 기술이 AOP이다.

AOP 클래스는 컴포넌트 스캔쓰기도 하지만 스프링 빈에 등록해서 쓴다.
> @Bean으로 등록했을 때 순환 참조 에러
> - @Around 코드에서 SpringConfig의 TimeTraceAop() 메소드도 AOP로 처리하게 됨
> - 이게 바로 자기 자신인 TimeTraceAop를 생성하는 코드라 순환 참조 문제 발생
> - 컴포넌트 스캔을 사용할 때는 이런 코드 자체가 없기 때문에 문제가 발생하지 않음
> - 해결 : AOP 대상에서 SpringConfig 제외하기 -> @Around("execution(* hello.hellospring..*(..)) && !target(hello.hellospring.SpringConfig)")

메소드 호츨 때마다 인터셉트가 걸리는 것

보통 패키지 레벨로 적용시킨다. (ex. service 하위만 적용하고 싶다)

**해결**
- 회원가입, 회원 조회등 핵심 관심사항과 시간을 측정하는 공통 관심 사항을 분리한다.
- 시간을 측정하는 로직을 별도의 공통 로직으로 만들었다.
- 핵심 관심 사항을 깔끔하게 유지할 수 있다.
- 변경이 필요하면 이 로직만 변경하면 된다.
- 원하는 적용 대상을 선택할 수 있다.


### 출처

> 인프런 '스프링 입문 - 코드로 배우는 스프링 부트, 웹 MVC, DB 접근 기술'